<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <title>Store App</title>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/site.css">
</head>

<body>
    <nav class="navbar navbar-light bg-light fixed-top">
        <a class="navbar-brand" href="index.html">
            <img src="assets/online-store.svg" width="30" height="30" class="d-inline-block align-top" alt="">
            Online Store
        </a>
        <a class="float-right" href="user.html" id="user-url">
            <img src="assets/user.svg" width="30" height="30" class="d-inline-block align-top" alt="">
        </a>
    </nav>
    <div class="container main-app">
        <h1 id="hello-user"></h1>

        <div id="data">
            <div class="row d-none" id="add-button">
                <div class="col-md-4 col-md-offset-4" style="margin: 0 auto;">
                    <div class="card" style="margin-bottom: 15px;">
                        <div class="card-body">
                            <a id="Add New" class="btn btn-sm btn-success btn-block" href="new-item.html">Add new Item</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/popper.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/site.js"></script>
    <script>
        $(document).bind('deviceready', function () {
            if (localStorage.getItem('user') === undefined || localStorage.getItem('user') == null) {
                window.location.href = 'user.html';
            } else {
                $('#user-url').attr('href', 'logout.html');
                $('#user-url > img').attr('src', 'assets/logout.svg');
            }

            var user = JSON.parse(localStorage.getItem('user'));
            $('#hello-user').html('Hello, ' + user.firstName + '!');
            $('#add-button').removeClass('d-none');
            $.ajax({
                type: 'GET',
                url: apiUrl + 'data',
                crossDomain: true,
                headers: {
                    "Content-Type": "application/json; charset=UTF-8",
                    "Authorization": "Bearer " + user.token
                },
                success: function (resultData) {
                    console.log(resultData);
                    for (let i = 0; i < resultData.length; i++) {
                        const item = resultData[i];
                        var result = '<div class="row">' +
                            '<div class="col-md-4 col-md-offset-4" style="margin: 0 auto;">' +
                            '<div class="card" style="margin-bottom: 15px;">' +
                            '<div class="card-header">' +
                            'Item #' + item.id +
                            '</div>' +
                            '<div class="card-body">' +
                            '<h4>' + item.name + '</h4>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>';
                        $('#data').append(result);
                    }
                },
                error: function (xhr, status, error) {
                    if (xhr.status == 401) {
                        localStorage.clear();
                        window.location.href = 'user.html';
                    }
                }
            });
        });
    </script>
</body>

</html>